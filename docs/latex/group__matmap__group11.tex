\hypertarget{group__matmap__group11}{\section{utility routines}
\label{group__matmap__group11}\index{utility routines@{utility routines}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{group__matmap__group11_ga16fec1005b6f01bda1dd6154c26c27ed}{Mat\-Init} (\hyperlink{structMat}{Mat} $\ast$A, int m, int nnz, int $\ast$indices, double $\ast$values, int flag\#ifdef W\-\_\-\-M\-P\-I, M\-P\-I\-\_\-\-Comm comm\#endif)
\item 
void \hyperlink{group__matmap__group11_gaaf26c7678367e6757392c03abd22a105}{Mat\-Set\-Indices} (\hyperlink{structMat}{Mat} $\ast$A, int m, int nnz, int $\ast$indices)
\item 
void \hyperlink{group__matmap__group11_gad3d5adb742e7a82454fcd6eede21da91}{Mat\-Set\-Values} (\hyperlink{structMat}{Mat} $\ast$A, int m, int nnz, double $\ast$values)
\item 
void \hyperlink{group__matmap__group11_ga4e1732c63feba9e589b5037d0a25ab75}{Mat\-Free} (\hyperlink{structMat}{Mat} $\ast$A)
\item 
int \hyperlink{group__matmap__group11_ga56b5e9bda4e4ad0a2c4f2f12e94d077e}{Mat\-Load} (\hyperlink{structMat}{Mat} $\ast$mat, char $\ast$filename)
\item 
int \hyperlink{group__matmap__group11_ga792b187cf2f23e526ecd5e2c3cbb9dab}{Mat\-Save} (\hyperlink{structMat}{Mat} $\ast$mat, char $\ast$filename)
\item 
int \hyperlink{group__matmap__group11_gae31f7ccb10cda5c97e49f640feed1ad4}{Mat\-Local\-Shape} (\hyperlink{structMat}{Mat} $\ast$A, int sflag)
\item 
int \hyperlink{group__matmap__group11_ga61b3b348d7c039aadfc3196e6b83535a}{Mat\-Com\-Shape} (\hyperlink{structMat}{Mat} $\ast$A, int flag, M\-P\-I\-\_\-\-Comm comm)
\item 
int \hyperlink{group__matmap__group11_ga1a51d7e8153d33045482100bbd07d0a9}{Tr\-Mat\-Vec\-Prod} (\hyperlink{structMat}{Mat} $\ast$A, double $\ast$y, double $\ast$x, int pflag)
\item 
int \hyperlink{group__matmap__group11_ga8e522200e7c693e4d81ff3ce3a1e24ff}{Mat\-Info} (\hyperlink{structMat}{Mat} $\ast$mat, int verbose, char $\ast$filename)
\begin{DoxyCompactList}\small\item\em Print information about a matrix. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
These are auxiliary utility routines. They may be used in both memory-\/shared/sequential and dsitributed contexts, though their syntax may change depending on that. 

\subsection{Function Documentation}
\hypertarget{group__matmap__group11_ga16fec1005b6f01bda1dd6154c26c27ed}{\index{utility routines@{utility routines}!Mat\-Init@{Mat\-Init}}
\index{Mat\-Init@{Mat\-Init}!utility routines@{utility routines}}
\subsubsection[{Mat\-Init}]{\setlength{\rightskip}{0pt plus 5cm}int Mat\-Init (
\begin{DoxyParamCaption}
\item[{{\bf Mat} $\ast$}]{A, }
\item[{int}]{m, }
\item[{int}]{nnz, }
\item[{int $\ast$}]{indices, }
\item[{double $\ast$}]{values, }
\item[{int flag\#ifdef}]{W\-\_\-\-M\-P\-I, }
\item[{M\-P\-I\-\_\-\-Comm comm\#}]{endif}
\end{DoxyParamCaption}
)}}\label{group__matmap__group11_ga16fec1005b6f01bda1dd6154c26c27ed}
Create a matrix specifying the number of local rows m, the number of non-\/zero elements per row nnz , indices tab, values tab, flag for communication and a communicator comm. indices and values tabs must be allocated and contain at least m$\ast$nnz elements. It represents column indices of the nonzero elements. Respectively values tab represents the non-\/zero values. After call Mat\-Init, all precomputation are done and the matrix structure is ready to use. That means you can start applying matrix operation. Another way to initialize a matrix structure is to apply step by step \-:
\begin{DoxyItemize}
\item Mat\-Set\-Indices
\item Mat\-Set\-Values
\item Mat\-Local\-Shape
\item Mat\-Com\-Shape
\end{DoxyItemize}

\begin{DoxyWarning}{Warning}
do not modify indices tab until you will use the matrix structure. 

\mbox{[}M\-P\-I C\-O\-M\-M!\mbox{]} with Midapack sequential version, there is no communicator argument. 
\end{DoxyWarning}

\begin{DoxyParams}{Parameters}
{\em A} & pointer to a \hyperlink{structMat}{Mat} struct \\
\hline
{\em m} & number of local rows \\
\hline
{\em nnz} & number of non-\/zero per row \\
\hline
{\em indices} & input tab (modified) \\
\hline
{\em values} & input tab \\
\hline
{\em flag} & communication flag \\
\hline
{\em comm} & M\-P\-I communicator\\
\hline
\end{DoxyParams}
\begin{DoxySeeAlso}{See also}
\hyperlink{group__matmap__group11_ga4e1732c63feba9e589b5037d0a25ab75}{Mat\-Free} 
\end{DoxySeeAlso}


Definition at line \hyperlink{mapmat_8c_source_l00043}{43} of file \hyperlink{mapmat_8c_source}{mapmat.\-c}.

\hypertarget{group__matmap__group11_gaaf26c7678367e6757392c03abd22a105}{\index{utility routines@{utility routines}!Mat\-Set\-Indices@{Mat\-Set\-Indices}}
\index{Mat\-Set\-Indices@{Mat\-Set\-Indices}!utility routines@{utility routines}}
\subsubsection[{Mat\-Set\-Indices}]{\setlength{\rightskip}{0pt plus 5cm}void Mat\-Set\-Indices (
\begin{DoxyParamCaption}
\item[{{\bf Mat} $\ast$}]{A, }
\item[{int}]{m, }
\item[{int}]{nnz, }
\item[{int $\ast$}]{indices}
\end{DoxyParamCaption}
)}}\label{group__matmap__group11_gaaf26c7678367e6757392c03abd22a105}
Set column indices of the nonzero elements. indices tab must be allocated and contains at least m$\ast$nnz elements. 
\begin{DoxyParams}{Parameters}
{\em A} & pointer to a \hyperlink{structMat}{Mat} struct \\
\hline
{\em m} & number of local rows \\
\hline
{\em nnz} & number of non-\/zero per row \\
\hline
{\em indices} & input tab \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line \hyperlink{mapmat_8c_source_l00070}{70} of file \hyperlink{mapmat_8c_source}{mapmat.\-c}.

\hypertarget{group__matmap__group11_gad3d5adb742e7a82454fcd6eede21da91}{\index{utility routines@{utility routines}!Mat\-Set\-Values@{Mat\-Set\-Values}}
\index{Mat\-Set\-Values@{Mat\-Set\-Values}!utility routines@{utility routines}}
\subsubsection[{Mat\-Set\-Values}]{\setlength{\rightskip}{0pt plus 5cm}void Mat\-Set\-Values (
\begin{DoxyParamCaption}
\item[{{\bf Mat} $\ast$}]{A, }
\item[{int}]{m, }
\item[{int}]{nnz, }
\item[{double $\ast$}]{values}
\end{DoxyParamCaption}
)}}\label{group__matmap__group11_gad3d5adb742e7a82454fcd6eede21da91}
Set values of the nonzero elements. values tab must be allocated and contains at least m$\ast$nnz values. 
\begin{DoxyParams}{Parameters}
{\em A} & pointer to a \hyperlink{structMat}{Mat} struct \\
\hline
{\em m} & number of local rows \\
\hline
{\em nnz} & number of non-\/zero per row \\
\hline
{\em values} & input tab \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line \hyperlink{mapmat_8c_source_l00085}{85} of file \hyperlink{mapmat_8c_source}{mapmat.\-c}.

\hypertarget{group__matmap__group11_ga4e1732c63feba9e589b5037d0a25ab75}{\index{utility routines@{utility routines}!Mat\-Free@{Mat\-Free}}
\index{Mat\-Free@{Mat\-Free}!utility routines@{utility routines}}
\subsubsection[{Mat\-Free}]{\setlength{\rightskip}{0pt plus 5cm}void Mat\-Free (
\begin{DoxyParamCaption}
\item[{{\bf Mat} $\ast$}]{A}
\end{DoxyParamCaption}
)}}\label{group__matmap__group11_ga4e1732c63feba9e589b5037d0a25ab75}
Free allocated tabs of a matrix structure including local indices tab and communication tabs. Do not free indices and values which user is responsible for. 
\begin{DoxyParams}{Parameters}
{\em A} & pointer to a \hyperlink{structMat}{Mat} struct \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\hyperlink{group__matmap__group11_ga16fec1005b6f01bda1dd6154c26c27ed}{Mat\-Init} \hyperlink{group__matmap__group11_gae31f7ccb10cda5c97e49f640feed1ad4}{Mat\-Local\-Shape} 
\end{DoxySeeAlso}


Definition at line \hyperlink{mapmat_8c_source_l00317}{317} of file \hyperlink{mapmat_8c_source}{mapmat.\-c}.

\hypertarget{group__matmap__group11_ga56b5e9bda4e4ad0a2c4f2f12e94d077e}{\index{utility routines@{utility routines}!Mat\-Load@{Mat\-Load}}
\index{Mat\-Load@{Mat\-Load}!utility routines@{utility routines}}
\subsubsection[{Mat\-Load}]{\setlength{\rightskip}{0pt plus 5cm}int Mat\-Load (
\begin{DoxyParamCaption}
\item[{{\bf Mat} $\ast$}]{mat, }
\item[{char $\ast$}]{filename}
\end{DoxyParamCaption}
)}}\label{group__matmap__group11_ga56b5e9bda4e4ad0a2c4f2f12e94d077e}
Load matrix from a file. This is Mat\-Save dual routine which loads data into matrix reading a specified file (or several specified files). Number of files should equal number of processor. File format should be ascii files (for examples look at files generated by Map\-Mat\-Save routine). \begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000001}{Todo}]Implement to read several file formats as basic A\-S\-C\-I\-I, X\-M\-L, H\-D\-F5... \end{DoxyRefDesc}

\begin{DoxyParams}{Parameters}
{\em mat} & pointer to the \hyperlink{structMat}{Mat} \\
\hline
{\em filename} & basename of a file, actually data are loaded from several files denotes by \char`\"{}basename + processor number\char`\"{} \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
error code 
\end{DoxyReturn}


Definition at line \hyperlink{mapmat_8c_source_l00403}{403} of file \hyperlink{mapmat_8c_source}{mapmat.\-c}.

\hypertarget{group__matmap__group11_ga792b187cf2f23e526ecd5e2c3cbb9dab}{\index{utility routines@{utility routines}!Mat\-Save@{Mat\-Save}}
\index{Mat\-Save@{Mat\-Save}!utility routines@{utility routines}}
\subsubsection[{Mat\-Save}]{\setlength{\rightskip}{0pt plus 5cm}int Mat\-Save (
\begin{DoxyParamCaption}
\item[{{\bf Mat} $\ast$}]{mat, }
\item[{char $\ast$}]{filename}
\end{DoxyParamCaption}
)}}\label{group__matmap__group11_ga792b187cf2f23e526ecd5e2c3cbb9dab}
Write matrix into files This is the dual routine of Mat\-Load. It saves matrix data into files, and can be usefull to check that data are well stored. Obviously it performs I\-O, moreover with one file per processor. Therfore, just call this function in a development phase, with few data and few processors. 
\begin{DoxyParams}{Parameters}
{\em A} & pointer to the \hyperlink{structMat}{Mat} \\
\hline
{\em filename} & file basename, for instance passing \char`\"{}toto\char`\"{} should produce the output files named \char`\"{}toto\-\_\-\$(rank)\char`\"{} \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
error code 
\end{DoxyReturn}


Definition at line \hyperlink{mapmat_8c_source_l00451}{451} of file \hyperlink{mapmat_8c_source}{mapmat.\-c}.

\hypertarget{group__matmap__group11_gae31f7ccb10cda5c97e49f640feed1ad4}{\index{utility routines@{utility routines}!Mat\-Local\-Shape@{Mat\-Local\-Shape}}
\index{Mat\-Local\-Shape@{Mat\-Local\-Shape}!utility routines@{utility routines}}
\subsubsection[{Mat\-Local\-Shape}]{\setlength{\rightskip}{0pt plus 5cm}int Mat\-Local\-Shape (
\begin{DoxyParamCaption}
\item[{{\bf Mat} $\ast$}]{A, }
\item[{int}]{sflag}
\end{DoxyParamCaption}
)}}\label{group__matmap__group11_gae31f7ccb10cda5c97e49f640feed1ad4}
Compute a local indices into a dense vector, lindices, and reindices indices tab according the this local dense vector. For this three steps are performed \-:
\begin{DoxyItemize}
\item sort and merge indices tab,
\item allocate lindices of size lcount and copy the sorted indices
\item reindex indices according the local indices
\end{DoxyItemize}

\begin{DoxyWarning}{Warning}
lindices is internally allocated ( to free it, use Mat\-Free ) 
\end{DoxyWarning}
\begin{DoxySeeAlso}{See also}
\hyperlink{group__matmap__group11_ga61b3b348d7c039aadfc3196e6b83535a}{Mat\-Com\-Shape} \hyperlink{group__matmap__group11_ga4e1732c63feba9e589b5037d0a25ab75}{Mat\-Free} \hyperlink{group__matmap__group11_gaaf26c7678367e6757392c03abd22a105}{Mat\-Set\-Indices} 
\end{DoxySeeAlso}


Definition at line \hyperlink{mapmat_8c_source_l00489}{489} of file \hyperlink{mapmat_8c_source}{mapmat.\-c}.

\hypertarget{group__matmap__group11_ga61b3b348d7c039aadfc3196e6b83535a}{\index{utility routines@{utility routines}!Mat\-Com\-Shape@{Mat\-Com\-Shape}}
\index{Mat\-Com\-Shape@{Mat\-Com\-Shape}!utility routines@{utility routines}}
\subsubsection[{Mat\-Com\-Shape}]{\setlength{\rightskip}{0pt plus 5cm}int Mat\-Com\-Shape (
\begin{DoxyParamCaption}
\item[{{\bf Mat} $\ast$}]{A, }
\item[{int}]{flag, }
\item[{M\-P\-I\-\_\-\-Comm}]{comm}
\end{DoxyParamCaption}
)}}\label{group__matmap__group11_ga61b3b348d7c039aadfc3196e6b83535a}
Transform the matrix data structure, identifying columns shared by several processors \begin{DoxyWarning}{Warning}
\mbox{[}M\-P\-I O\-N\-L\-Y!\mbox{]} this function does not exist in Midapack sequential version 
\end{DoxyWarning}
\begin{DoxySeeAlso}{See also}
\hyperlink{group__matmap__group11_gae31f7ccb10cda5c97e49f640feed1ad4}{Mat\-Local\-Shape} \hyperlink{group__matmap__group11_ga16fec1005b6f01bda1dd6154c26c27ed}{Mat\-Init} \hyperlink{group__matmap__group11_ga1a51d7e8153d33045482100bbd07d0a9}{Tr\-Mat\-Vec\-Prod} 
\end{DoxySeeAlso}


Definition at line \hyperlink{mapmat_8c_source_l00515}{515} of file \hyperlink{mapmat_8c_source}{mapmat.\-c}.

\hypertarget{group__matmap__group11_ga1a51d7e8153d33045482100bbd07d0a9}{\index{utility routines@{utility routines}!Tr\-Mat\-Vec\-Prod@{Tr\-Mat\-Vec\-Prod}}
\index{Tr\-Mat\-Vec\-Prod@{Tr\-Mat\-Vec\-Prod}!utility routines@{utility routines}}
\subsubsection[{Tr\-Mat\-Vec\-Prod}]{\setlength{\rightskip}{0pt plus 5cm}int Tr\-Mat\-Vec\-Prod (
\begin{DoxyParamCaption}
\item[{{\bf Mat} $\ast$}]{A, }
\item[{double $\ast$}]{y, }
\item[{double $\ast$}]{x, }
\item[{int}]{pflag}
\end{DoxyParamCaption}
)}}\label{group__matmap__group11_ga1a51d7e8153d33045482100bbd07d0a9}
Perform a transposed matrix-\/vector multiplication, $x \leftarrow A^t y$ using a precomputed communication scheme. Before calling this routine, the communication structure should have been set, calling Mat\-Init or Mat\-Com\-Shape. The routine can be divided in two steps \-:
\begin{DoxyItemize}
\item a local matrix vector multiplication
\item a collective-\/reduce. it consits in a sum reduce over all processes.
\end{DoxyItemize}

The collective reduce is performed using algorithm previously defined \-: ring, butterfly ... \begin{DoxySeeAlso}{See also}
\hyperlink{group__matmap__group12a_gaf757d9249d31d2839b3376ac2e3f5574}{Mat\-Vec\-Prod} \hyperlink{group__matmap__group11_ga61b3b348d7c039aadfc3196e6b83535a}{Mat\-Com\-Shape} \hyperlink{group__matmap__group12b_ga46ad4af50377be15a0aa50f416a53ade}{Tr\-Mat\-Vec\-Prod\-\_\-\-Naive} \hyperlink{group__matmap__group11_ga16fec1005b6f01bda1dd6154c26c27ed}{Mat\-Init} 
\end{DoxySeeAlso}

\begin{DoxyParams}{Parameters}
{\em A} & a pointer to a \hyperlink{structMat}{Mat} \\
\hline
{\em y} & local input vector (distributed) \\
\hline
{\em x} & local output vector (overlapped) \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{mapmat_8c_source_l00723}{723} of file \hyperlink{mapmat_8c_source}{mapmat.\-c}.

\hypertarget{group__matmap__group11_ga8e522200e7c693e4d81ff3ce3a1e24ff}{\index{utility routines@{utility routines}!Mat\-Info@{Mat\-Info}}
\index{Mat\-Info@{Mat\-Info}!utility routines@{utility routines}}
\subsubsection[{Mat\-Info}]{\setlength{\rightskip}{0pt plus 5cm}int Mat\-Info (
\begin{DoxyParamCaption}
\item[{{\bf Mat} $\ast$}]{mat, }
\item[{int}]{verbose, }
\item[{char $\ast$}]{filename}
\end{DoxyParamCaption}
)}}\label{group__matmap__group11_ga8e522200e7c693e4d81ff3ce3a1e24ff}


Print information about a matrix. 

\par
 Usefull function to check, debug or bench. It prints matrix array sizes. \begin{DoxySeeAlso}{See also}
\hyperlink{group__matmap__group11_ga792b187cf2f23e526ecd5e2c3cbb9dab}{Mat\-Save} 
\end{DoxySeeAlso}

\begin{DoxyParams}{Parameters}
{\em A} & pointer to the \hyperlink{structMat}{Mat} \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{mapmat_8c_source_l00758}{758} of file \hyperlink{mapmat_8c_source}{mapmat.\-c}.

