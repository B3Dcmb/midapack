
# link openBLAS library
OPENBLAS_INC = -I$(OPENBLAS_DIR)/include
OPENBLAS_LIB = -L$(OPENBLAS_DIR)/lib -lopenblas -lpthread -lgfortran

# supplementary libraries

CFITSIO_INC = -I$(CFITSIO_DIR)/include
CFITSIO_LIB = -L$(CFITSIO_DIR)/lib -lcfitsio

##############   t e s t s   ############

all:
	make mappraiser

mappraiser:
	@echo "start compiling MAPPRAISER ........"
	make $(MAPPRAISER_OBJ)/createToeplitz.o \
	$(MAPPRAISER_OBJ)/precond.o \
	$(MAPPRAISER_OBJ)/pcg_true.o \
	$(MAPPRAISER_OBJ)/iofiles.o \
	$(MAPPRAISER_OBJ)/mappraiser.o \

$(MAPPRAISER_OBJ)/createToeplitz.o: createToeplitz.c
	$(CC) -c $< $(INC) $(LIB) -o $@

$(MAPPRAISER_OBJ)/precond.o: precond.c
	$(CC) -c $< $(INC) $(LIB) -o $@

$(MAPPRAISER_OBJ)/pcg_true.o: pcg_true.c
	$(CC) -c $< $(INC) $(LIB) $(CFITSIO_INC) $(CFITSIO_LIB) -o $@

$(MAPPRAISER_OBJ)/iofiles.o: iofiles.c
	$(CC) -c $< $(INC) $(LIB) $(CFITSIO_INC) $(CFITSIO_LIB) -o $@

$(MAPPRAISER_OBJ)/mappraiser.o: mappraiser.c
	$(CC) -c $< $(INC) $(LIB) $(CFITSIO_INC) $(CFITSIO_LIB) $(OPENBLAS_INC) $(OPENBLAS_LIB) -lfftw3 -lfftw3_threads -o $@


##############   u t i l s   #############

clean:
	rm -f $(MAPPRAISER_OBJ)/*.o ;
